---
phase: 18-wizard-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/tarot/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Wizard presents deck choice before mode selection"
    - "User can select Major Arcana only (22 cards)"
    - "User can select Full deck (78 cards)"
    - "Major Arcana only is the default selection"
    - "Digital mode draws from correct card pool based on deck choice"
  artifacts:
    - path: "skills/tarot/SKILL.md"
      provides: "Deck selection wizard step (Question 2.5)"
      contains: "Which deck would you like to use"
    - path: "skills/tarot/SKILL.md"
      provides: "Conditional shuf ranges in Mode Dispatch"
      contains: "shuf -i 0-77"
  key_links:
    - from: "Wizard Question 2.5"
      to: "Mode Dispatch section"
      via: "deck selection state"
      pattern: "deck.*Major Arcana|deck.*Full deck"
---

<objective>
Add deck selection to the wizard flow and update mode dispatch for conditional card pools.

Purpose: Enable users to choose between Major Arcana only (22 cards) and Full 78-card deck, with the choice affecting random draw ranges. This implements WIZD-01 (deck selection step) and WIZD-02 (deck choice affects card pool).

Output: Updated SKILL.md with new wizard question and conditional mode dispatch logic.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-wizard-enhancement/18-CONTEXT.md
@.planning/phases/18-wizard-enhancement/18-RESEARCH.md
@skills/tarot/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Deck Selection Wizard Question</name>
  <files>skills/tarot/SKILL.md</files>
  <action>
Insert a new wizard question between Question 2 (Spread) and Question 3 (Mode). This becomes "Question 2.5" conceptually, but will be labeled as a natural part of the wizard flow.

In the "## Wizard: Collect Reading Parameters" section, after Question 2 (Spread) and before Question 3 (Mode), add:

```
Question 2.5 (Deck):
- question: "Which deck would you like to use?"
- header: "Deck"
- multiSelect: false
- options:
  - label: "Major Arcana only (22 cards)"
    description: "Focused archetypal readings - recommended for most questions"
  - label: "Full deck (78 cards)"
    description: "Complete tarot experience with all suits"
```

Update the "After collecting wizard responses" section to include:
- Deck selection: Determines card pool (0-21 for Major Arcana only, 0-77 for Full deck)

IMPORTANT: "Major Arcana only (22 cards)" MUST be listed first and described as recommended. This preserves backwards compatibility - existing users who quickly click through will get the same Major-only behavior.
  </action>
  <verify>
Read SKILL.md and confirm:
1. New "Question 2.5 (Deck)" section exists between Question 2 and Question 3
2. "Major Arcana only (22 cards)" is the first option
3. Description mentions "recommended"
4. "After collecting wizard responses" section mentions deck selection
  </verify>
  <done>Wizard flow includes deck selection step with Major Arcana as default/recommended option</done>
</task>

<task type="auto">
  <name>Task 2: Update Mode Dispatch for Conditional Card Pools</name>
  <files>skills/tarot/SKILL.md</files>
  <action>
Update the "## Mode Dispatch" section to use conditional shuf ranges based on deck choice.

Replace the existing Digital Mode card selection commands with conditional logic:

```
**Digital Mode (user selected "Digital (Recommended)"):**

Based on deck choice from wizard:

**If deck is "Major Arcana only":**
- Single card: `!shuf -i 0-21 -n 1`
- Multi-card: `!shuf -i 0-21 -n [position_count]`

**If deck is "Full deck (78 cards)":**
- Single card: `!shuf -i 0-77 -n 1`
- Multi-card: `!shuf -i 0-77 -n [position_count]`

Proceed directly to card identification and file loading.
```

Also update the "## Spread Selection Logic" section to use conditional ranges. Find all occurrences of `shuf -i 0-21` in that section and update them to reference deck choice:

For Single Card Spread:
- If Major-only: `!shuf -i 0-21 -n 1`
- If Full deck: `!shuf -i 0-77 -n 1`

For Three-Card Spread and other spreads:
- If Major-only: `!shuf -i 0-21 -n 3`
- If Full deck: `!shuf -i 0-77 -n 3`

The pattern should be consistent: deck choice determines range, spread determines count.
  </action>
  <verify>
Read SKILL.md and confirm:
1. Mode Dispatch section has conditional logic for Major-only vs Full deck
2. `shuf -i 0-77` appears for Full deck option
3. Original `shuf -i 0-21` is preserved for Major-only option
4. Spread Selection Logic section also uses conditional ranges
  </verify>
  <done>Digital mode draws from 0-21 for Major Arcana or 0-77 for Full deck based on wizard selection</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Read SKILL.md and verify deck selection question exists
2. Verify conditional shuf commands exist for both deck options
3. Trace the flow: Wizard Question 2.5 -> deck choice -> Mode Dispatch -> correct shuf range
</verification>

<success_criteria>
- Wizard flow includes deck selection between spread and mode questions
- Major Arcana only is default/recommended option (listed first)
- Digital mode uses shuf -i 0-21 for Major-only, shuf -i 0-77 for Full deck
- No breaking changes to existing Major Arcana behavior
</success_criteria>

<output>
After completion, create `.planning/phases/18-wizard-enhancement/18-01-SUMMARY.md`
</output>
