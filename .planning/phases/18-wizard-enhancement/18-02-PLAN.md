---
phase: 18-wizard-enhancement
plan: 02
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - skills/tarot/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Card index contains all 78 cards with correct numbering"
    - "Physical mode accepts 'three of cups' for Three of Cups"
    - "Physical mode accepts 'queen cups' for Queen of Cups"
    - "Physical mode accepts '3 cups' for Three of Cups"
    - "Physical mode suggests closest match for typos"
    - "Numeric input 0-77 works in physical mode"
  artifacts:
    - path: "skills/tarot/SKILL.md"
      provides: "78-card index table"
      contains: "King of Pentacles"
    - path: "skills/tarot/SKILL.md"
      provides: "Minor Arcana fuzzy matching rules"
      contains: "three of cups"
  key_links:
    - from: "Card Matching Functions"
      to: "Card Index"
      via: "name lookup"
      pattern: "Ace of Wands|Queen of Cups"
    - from: "Physical Mode Card Entry"
      to: "Card Matching Functions"
      via: "validation"
      pattern: "match_card.*0-77"
---

<objective>
Expand the card index to 78 cards and update fuzzy matching to support all Minor Arcana input variations.

Purpose: Enable physical mode to recognize all 78 cards with flexible input matching. This implements WIZD-03 (physical mode supports all 78 cards with fuzzy matching).

Output: Updated SKILL.md with expanded card index (78 cards) and comprehensive fuzzy matching rules for Minor Arcana.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-wizard-enhancement/18-CONTEXT.md
@.planning/phases/18-wizard-enhancement/18-RESEARCH.md
@.planning/phases/18-wizard-enhancement/18-01-SUMMARY.md
@skills/tarot/SKILL.md
@skills/tarot/cards/wands.md
@skills/tarot/cards/cups.md
@skills/tarot/cards/swords.md
@skills/tarot/cards/pentacles.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand Card Index to 78 Cards</name>
  <files>skills/tarot/SKILL.md</files>
  <action>
Expand the "## Card Index" section from 22 cards to 78 cards using this numbering scheme:

- Major Arcana: 0-21 (keep existing entries unchanged)
- Wands: 22-35 (Ace=22, Two=23, ..., Ten=31, Page=32, Knight=33, Queen=34, King=35)
- Cups: 36-49 (Ace=36, Two=37, ..., Ten=45, Page=46, Knight=47, Queen=48, King=49)
- Swords: 50-63 (Ace=50, Two=51, ..., Ten=59, Page=60, Knight=61, Queen=62, King=63)
- Pentacles: 64-77 (Ace=64, Two=65, ..., Ten=73, Page=74, Knight=75, Queen=76, King=77)

Format for Minor Arcana entries (extract keywords from corresponding card files):

```
| 22 | Ace of Wands | Wands | Creative spark, raw potential, inspired beginning |
| 23 | Two of Wands | Wands | Planning, bold vision, choosing direction |
...
| 77 | King of Pentacles | Pentacles | Mastery, abundance, reliable authority |
```

Read each suit file (wands.md, cups.md, swords.md, pentacles.md) to extract the first 3-4 keywords from each card's Themes field for the index.

The table header remains:
```
| # | Name | Suit | Keywords |
|---|------|------|----------|
```

IMPORTANT: Keep existing Major Arcana entries (0-21) exactly as they are. Only ADD the 56 Minor Arcana entries.
  </action>
  <verify>
Read SKILL.md Card Index section and confirm:
1. Table has 78 rows (plus header)
2. Entry 22 is "Ace of Wands | Wands"
3. Entry 35 is "King of Wands | Wands"
4. Entry 36 is "Ace of Cups | Cups"
5. Entry 77 is "King of Pentacles | Pentacles"
6. Major Arcana entries (0-21) are unchanged
  </verify>
  <done>Card index contains all 78 cards with correct numbering (0-21 Major, 22-35 Wands, 36-49 Cups, 50-63 Swords, 64-77 Pentacles)</done>
</task>

<task type="auto">
  <name>Task 2: Update Fuzzy Matching for 78 Cards</name>
  <files>skills/tarot/SKILL.md</files>
  <action>
Update the "## Card Matching Functions" section to support all 78 cards with comprehensive fuzzy matching.

Expand the match_card function logic:

1. **Normalize input:** (keep existing)
   - Convert to lowercase
   - Strip leading "the " prefix
   - Trim whitespace

2. **Exact match against card names:** (expand)
   - Major Arcana: Keep existing matches (fool, magician, etc.)
   - Minor Arcana: Match normalized full names (ace of wands, three of cups, etc.)

3. **Common variants:** (ADD new section for Minor Arcana)

   **Minor Arcana pip cards (Ace-Ten):**
   - Number words: "three of cups", "three cups" -> Three of Cups
   - Arabic numerals: "3 of cups", "3 cups" -> Three of Cups
   - Roman numerals: "III cups", "III of cups" -> Three of Cups
   - "of" is optional: "ace wands" matches "Ace of Wands"
   - Special case: "ace" or "1" both valid for Ace cards

   **Minor Arcana court cards (Page, Knight, Queen, King):**
   - Full form: "queen of cups" -> Queen of Cups
   - Short form: "queen cups" -> Queen of Cups
   - Abbreviations: "Q cups", "Q of cups" -> Queen of Cups
   - Court abbreviations:
     - P, page -> Page
     - Kn, knight -> Knight
     - Q, queen -> Queen
     - K, king -> King

   **Suit abbreviations:**
   - wands, w -> Wands
   - cups, c -> Cups
   - swords, s -> Swords
   - pentacles, pent, p -> Pentacles

4. **Numeric input:** (expand range)
   - If input is a number, validate range based on deck mode:
     - Major-only mode: 0-21
     - Full deck mode: 0-77
   - Convert directly to card number

5. **Typo handling:** (keep existing logic, apply to all 78)
   - If no exact or variant match found, suggest closest match
   - "Did you mean '[Card Name]'?" with confirmation
   - User confirms yes/no

Also update the "**Card name lookup table:**" to include all 78 cards, or replace it with a reference to the Card Index table to avoid duplication:

"Use the Card Index table above to map card numbers to their full names (0-77)."

Update "**Physical Mode Card Entry**" section where it says "Try the card's name (like 'The Fool' or 'Death') or its number (0-21)" to:
- For Major-only deck: "(0-21)"
- For Full deck: "(like 'Three of Cups' or 'Queen of Wands') or its number (0-77)"

Update any hardcoded "0-21" range references in Physical Mode to be conditional on deck choice, matching the pattern from Plan 01.
  </action>
  <verify>
Read SKILL.md Card Matching Functions section and confirm:
1. Minor Arcana matching patterns are documented
2. Number word variants listed (three, 3, III for Three)
3. Court card abbreviations listed (Q, Kn, P, K)
4. Suit abbreviations listed
5. "of" documented as optional
6. Numeric range mentions 0-77 for Full deck
7. Physical Mode Card Entry section updated with Full deck examples
  </verify>
  <done>Physical mode fuzzy matching supports all 78 cards with variations: "3 of cups", "three cups", "III cups", "queen cups", "Q cups" etc.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Card Index table has exactly 78 entries (0-77)
2. Card Matching Functions section documents Minor Arcana patterns
3. Mentally trace: user enters "3 cups" -> normalization -> variant match -> Three of Cups (card 38)
4. Mentally trace: user enters "Q wands" -> normalization -> court abbreviation match -> Queen of Wands (card 34)
</verification>

<success_criteria>
- Card index contains all 78 cards with correct suit-based numbering
- Physical mode accepts: "three of cups", "3 of cups", "III cups", "3 cups", "three cups"
- Physical mode accepts court card variations: "queen cups", "Q cups", "queen of cups"
- Typo suggestions work for all 78 cards
- Numeric input 0-77 valid in Full deck mode
</success_criteria>

<output>
After completion, create `.planning/phases/18-wizard-enhancement/18-02-SUMMARY.md`
</output>
