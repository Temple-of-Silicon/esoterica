---
phase: 07-spread-options
plan: 02
type: execute
wave: 2
depends_on: [07-01]
files_modified: [skills/tarot/SKILL.md]
autonomous: true

must_haves:
  truths:
    - "Claude suggests generates 3 contextual position names based on user's question"
    - "User can approve or reject LLM-suggested positions (rejection triggers regeneration)"
    - "Custom spread accepts comma-separated position names"
    - "Custom spread validates 1-5 positions (rejects 0 or >5)"
    - "Both spread types show positions before drawing cards"
  artifacts:
    - path: "skills/tarot/SKILL.md"
      provides: "LLM-suggested and custom spread implementations"
      contains: ["Claude suggests", "comma-separated", "1-5", "regenerate"]
  key_links:
    - from: "User's question (wizard Q1)"
      to: "LLM-suggested position generation"
      via: "Contextual analysis prompt"
      pattern: "based on.*question.*generate.*positions"
    - from: "Custom input"
      to: "Position validation"
      via: "Count validation (1-5)"
      pattern: "(at least 1|maximum 5|1-5)"
---

<objective>
Implement LLM-suggested and custom spread types to complete the four spread options available in the wizard.

Purpose: Enable Claude to generate contextual spreads and allow users to define their own position names, completing the spread selection feature set.
Output: Working LLM-suggested spread (with approval flow) and custom spread (with validation) implementations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-spread-options/07-CONTEXT.md
@.planning/phases/07-spread-options/07-RESEARCH.md
@.planning/phases/07-spread-options/07-01-SUMMARY.md
@skills/tarot/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement LLM-suggested spread in Spread Selection Logic</name>
  <files>skills/tarot/SKILL.md</files>
  <action>
Replace the placeholder "Claude Suggests Spread" section in "## Spread Selection Logic" with full implementation:

```markdown
### Claude Suggests Spread
If user selected "Claude suggests":

1. **Generate contextual positions** based on the user's question from wizard Question 1:
   - Review what the user shared about their question or situation
   - Generate exactly 3 position names that illuminate their specific context
   - Position names should be:
     * Specific to their context (not generic like "Past/Present/Future")
     * Actionable or insightful (help them see something new)
     * Concise (2-4 words each)

   **Example quality:**
   User asks about refactoring authentication:
   - Current State
   - Hidden Complexity
   - Path Forward

   User asks about a difficult conversation:
   - What's Unspoken
   - Your Leverage
   - Bridge to Build

2. **Present for approval:**
   "Based on your question, I suggest these three positions:

   1. **[Position 1]**
   2. **[Position 2]**
   3. **[Position 3]**

   Shall I proceed with these positions, or would you like me to suggest different ones?"

3. **Handle response:**
   - If user approves: Show position preview and draw 3 unique cards with `!shuf -i 0-21 -n 3`
   - If user requests different positions: Generate new positions (return to step 1)
   - Do NOT fall back to custom input - keep generating until user approves

4. **After approval, show preview and draw:**
   "You'll draw three cards for:
   1. **[Approved Position 1]**
   2. **[Approved Position 2]**
   3. **[Approved Position 3]**

   Drawing cards now..."

   Then draw: `!shuf -i 0-21 -n 3`
```

Key points per CONTEXT.md:
- Always exactly 3 cards (count is fixed)
- Approval flow should feel conversational, not form-like
- If rejected, regenerate (don't fall back to custom)
  </action>
  <verify>Read SKILL.md and confirm: (1) Claude Suggests section has full implementation, (2) Generates exactly 3 positions, (3) Shows for approval, (4) Regenerates on rejection (no fallback to custom).</verify>
  <done>LLM-suggested spread generates 3 contextual positions, shows for approval, and regenerates on rejection without fallback.</done>
</task>

<task type="auto">
  <name>Task 2: Implement custom spread in Spread Selection Logic</name>
  <files>skills/tarot/SKILL.md</files>
  <action>
Replace the placeholder "Custom Spread" section in "## Spread Selection Logic" with full implementation:

```markdown
### Custom Spread
If user selected "Custom":

1. **Collect position names:**
   Prompt the user:
   "Enter your position names, separated by commas (1-5 positions):

   Example: Past, Present, Future"

2. **Parse and validate input:**
   - Split on commas
   - Trim whitespace from each position
   - Filter out empty positions (handle "Position1, , Position3" gracefully)
   - Count remaining positions

   **Validation rules:**
   - Minimum: 1 position (custom single-card with named position is valid)
   - Maximum: 5 positions

   If count < 1: "Please enter at least 1 position name."
   If count > 5: "Maximum 5 positions allowed. You entered [N]. Please try again with 1-5 positions."

   On validation failure, re-prompt for input.

3. **Show position preview and draw:**
   "You'll draw [N] card(s) for:
   1. **[Position 1]**
   2. **[Position 2]**
   [... up to 5]

   Drawing cards now..."

   Draw unique cards: `!shuf -i 0-21 -n [N]`
   - Each line of output corresponds to a position in order
```

Key points per CONTEXT.md:
- Single text input for comma-separated positions
- 1-5 cards allowed (custom single-card is valid)
- Don't validate position name content - only count matters
- Any text is valid for position names (emojis, special characters, etc.)
  </action>
  <verify>Read SKILL.md and confirm: (1) Custom section has full implementation, (2) Accepts comma-separated input, (3) Validates 1-5 count, (4) Shows position preview before drawing.</verify>
  <done>Custom spread accepts comma-separated positions with 1-5 validation and shows preview before drawing unique cards.</done>
</task>

<task type="auto">
  <name>Task 3: Update Reading Instructions for LLM-suggested and custom spreads</name>
  <files>skills/tarot/SKILL.md</files>
  <action>
Update the "## Reading Instructions" multi-card handling section to include guidance for LLM-suggested and custom positions:

In the "Handle spread type" guidance, add after the three-card preset bullet:

```markdown
   - **LLM-suggested spread**: Interpret each card through the contextually-generated position names. Since these positions were crafted for the user's specific question, lean into the specificity - the position names themselves guide interpretation.
   - **Custom spread**: Honor the user's chosen position names exactly. If they named a position "Shadow Self", interpret the card through that specific lens. The user chose these names for a reason.

   **Variable card counts (custom only):**
   - 1 card: Deep single-position focus
   - 2 cards: Dialogue or tension between positions
   - 3 cards: Classic triad narrative
   - 4-5 cards: More complex spread - ensure each position gets meaningful attention while still weaving together
```

Add to the reading structure templates section:

```markdown
**LLM-suggested or Custom spread structure (variable positions):**

[Voice-appropriate opening bookend]

"You'll draw [N] card(s) for:
1. [Position 1]
2. [Position 2]
[... as many as selected]"

**[Card 1 Name] as [Position 1]**
[Interpretation through this position's lens]

**[Card 2 Name] as [Position 2]**
[Interpretation through this position's lens]

[... continue for all positions]

**The Story They Tell Together**
[Weave all cards into cohesive narrative - how do the positions and cards interact?]

[Voice-appropriate closing with SPECIFIC reflective question drawing from the positions]
```
  </action>
  <verify>Read SKILL.md Reading Instructions and confirm: (1) LLM-suggested interpretation guidance exists, (2) Custom spread guidance honors user's position names, (3) Variable card count (1-5) handling included, (4) Template structure for variable positions exists.</verify>
  <done>Reading Instructions cover LLM-suggested and custom spreads with position-specific interpretation guidance and variable card count handling.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. "Claude suggests" generates exactly 3 contextual positions based on user's question
2. User can approve or request new suggestions (no fallback to custom on rejection)
3. "Custom" accepts comma-separated input and validates 1-5 positions
4. Custom spread handles edge cases (extra commas, whitespace) gracefully
5. Both spread types show positions before drawing cards
6. Reading instructions guide interpretation for all spread types
7. Full integration: wizard -> spread selection -> position preview -> card draw -> interpretation
</verification>

<success_criteria>
- LLM-suggested generates 3 contextual positions (specific to user's question, not generic)
- Approval flow is conversational; rejection triggers new suggestions
- Custom spread accepts 1-5 comma-separated position names
- Validation rejects 0 or >5 positions with helpful error message
- All four spread types work end-to-end: single, three-card preset, LLM-suggested, custom
- Position names shown to user BEFORE cards are drawn (all spread types)
</success_criteria>

<output>
After completion, create `.planning/phases/07-spread-options/07-02-SUMMARY.md`
</output>
