---
phase: 06-wizard-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [skills/tarot/SKILL.md]
autonomous: true

must_haves:
  truths:
    - "Running /tarot opens a tabbed wizard interface (not inline args)"
    - "Tab 1 collects user's question or context for the reading"
    - "Tab 2 presents spread selection (placeholder options for now)"
    - "Tab 3 presents mode selection (placeholder options for now)"
    - "Completing wizard triggers reading flow with collected inputs"
  artifacts:
    - path: "skills/tarot/SKILL.md"
      provides: "Wizard-enabled tarot skill"
      contains: "AskUserQuestion"
  key_links:
    - from: "skills/tarot/SKILL.md"
      to: "AskUserQuestion tool"
      via: "prompt instructions"
      pattern: "AskUserQuestion"
---

<objective>
Replace inline argument parsing with interactive wizard flow using AskUserQuestion.

Purpose: Transform /tarot from inline-args invocation to guided wizard experience that collects question, spread preference, and mode selection before performing reading.

Output: Modified SKILL.md that prompts Claude to use AskUserQuestion wizard, then proceeds with reading using collected inputs.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-wizard-infrastructure/06-RESEARCH.md
@skills/tarot/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Wizard Phase to SKILL.md</name>
  <files>skills/tarot/SKILL.md</files>
  <action>
Modify SKILL.md with these specific changes:

**1. Remove `context: fork` from frontmatter:**
The skill must run in main conversation for AskUserQuestion to work (research finding: subagents cannot use interactive tools).

**2. Add Wizard Instructions section BEFORE "Reading Context":**

Insert a new section titled "## Wizard: Collect Reading Parameters" that instructs Claude to:

```markdown
## Wizard: Collect Reading Parameters

Before performing any reading, you MUST use AskUserQuestion to collect the user's preferences. Do not skip this step or use inline arguments.

**Use AskUserQuestion with these three questions:**

Question 1 (Question):
- question: "What question or situation would you like insight on?"
- header: "Question"
- multiSelect: false
- options:
  - label: "General guidance"
    description: "No specific question - seeking general insight for today"
  - label: "Decision I'm facing"
    description: "Help thinking through a choice or crossroads"
  - label: "Situation I'm processing"
    description: "Understanding something that happened or is happening"

Question 2 (Spread):
- question: "Which spread would you like for this reading?"
- header: "Spread"
- multiSelect: false
- options:
  - label: "Single card (Recommended)"
    description: "One card focus - quick insight, clear message"
  - label: "Three card"
    description: "Past/Present/Future or Problem/Solution/Synthesis"
  - label: "Custom spread"
    description: "You specify the positions and meaning"

Question 3 (Mode):
- question: "How should cards be drawn?"
- header: "Mode"
- multiSelect: false
- options:
  - label: "Digital (Recommended)"
    description: "Random card selection - immediate reading"
  - label: "Physical deck"
    description: "You'll draw and enter the card(s) yourself"

**After collecting wizard responses:**
- User's question/context: Use for interpreting card meaning (or their custom input via "Other")
- Spread selection: For now, always perform single-card reading regardless of selection (Phase 7 implements spread logic)
- Mode selection: For now, always use digital random draw regardless of selection (Phase 8 implements physical mode)

Proceed to perform the reading using the collected question/context.
```

**3. Update maintainer notes (HTML comment at top):**
- Change "Invocation: Both user (/tarot) and Claude can invoke" to note wizard flow
- Remove references to inline arguments (--voice flag)
- Add note: "Wizard collects question/spread/mode via AskUserQuestion before reading"

**Important:** Keep ALL existing content below the wizard section intact:
- Major Arcana Meanings (all 22 cards)
- Voice System (mystic and grounded voices)
- Voice Examples
- Voice Consistency rules
- Reading Instructions

Do NOT modify voice system, card meanings, or reading instructions.
  </action>
  <verify>
Read skills/tarot/SKILL.md and confirm:
- `context: fork` is NOT in frontmatter
- "## Wizard: Collect Reading Parameters" section exists
- Section contains AskUserQuestion instructions with 3 questions
- All 22 Major Arcana card meanings still present
- Voice system section still present and unchanged
  </verify>
  <done>Wizard instructions added to SKILL.md with correct AskUserQuestion format and all existing content preserved</done>
</task>

<task type="auto">
  <name>Task 2: Update Reading Context to Use Wizard Values</name>
  <files>skills/tarot/SKILL.md</files>
  <action>
Update the "## Reading Context" section to work with wizard-collected values instead of $ARGUMENTS parsing.

**Current Reading Context (lines ~30-34):**
```markdown
## Reading Context

**Card drawn:** `!shuf -i 0-21 -n 1`

**Voice:** `!VOICE=$(echo "$ARGUMENTS" | grep -oiE '\-\-voice\s+(mystic|grounded)' | awk '{print tolower($2)}'); ...`

**Question/Context:** `!echo "$ARGUMENTS" | sed -E 's/--voice\s*(mystic|grounded)//gi' | ...`
```

**Replace with:**
```markdown
## Reading Context

**Card drawn:** `!shuf -i 0-21 -n 1`

**Voice:** `!VOICE=$(grep -E '^voice=(mystic|grounded)$' .tarot 2>/dev/null | cut -d= -f2); if [ -z "$VOICE" ]; then VOICE=$(grep -E '^voice=(mystic|grounded)$' "$HOME/.claude/tarot/config" 2>/dev/null | cut -d= -f2); fi; if [ -n "$VOICE" ]; then echo "$VOICE"; else echo "grounded"; fi`

**Question/Context:** (collected via wizard - use the user's response to Question 1)

**Spread:** (collected via wizard - use the user's response to Question 2; for Phase 6, always perform single-card reading)

**Mode:** (collected via wizard - use the user's response to Question 3; for Phase 6, always use digital random draw)
```

**Key changes:**
1. Voice: Remove --voice flag parsing from $ARGUMENTS (keep config file lookup: .tarot > ~/.claude/tarot/config > default grounded)
2. Question/Context: Replace shell parsing with note that wizard collects this
3. Add Spread and Mode fields as placeholders for future phases

**Why remove --voice from args:** The wizard doesn't collect voice preference. Voice remains config-based (decision already made). Users who want mystic voice set it in .tarot or ~/.claude/tarot/config.
  </action>
  <verify>
Read skills/tarot/SKILL.md and confirm:
- Voice shell command no longer references $ARGUMENTS or --voice flag
- Voice still reads from .tarot and ~/.claude/tarot/config with grounded default
- Question/Context references wizard collection, not $ARGUMENTS parsing
- Spread and Mode fields exist as placeholders
  </verify>
  <done>Reading Context updated to use wizard-collected values with voice remaining config-based</done>
</task>

<task type="auto">
  <name>Task 3: Update Reading Instructions for Wizard Flow</name>
  <files>skills/tarot/SKILL.md</files>
  <action>
Update the "## Reading Instructions" section to reference wizard-collected context instead of the old Question/Context field parsing.

**Find and update these references:**

1. In "Assess context depth" instruction:
   - Current: "check the **Question/Context** field"
   - Update to: "check the question/context the user provided via the wizard"

2. In "Connect card to context with echo" instruction:
   - Current: "If the querent asked a question"
   - Keep this wording (still valid)
   - The wizard collects the question, so this instruction still applies

3. Remove or update any references to:
   - "Quick draw" detection based on "0-1 sentences" - wizard always collects structured input
   - Instead, adapt based on whether user selected "General guidance" vs provided specific context via "Other"

**Updated context depth assessment:**
```markdown
1. **Assess context depth** - Based on wizard responses:
   - **Quick draw** (user selected "General guidance" without elaboration): 2 paragraphs, ~150-200 words
   - **Standard draw** (user selected a category like "Decision I'm facing"): 3 paragraphs, ~250-300 words
   - **Deep draw** (user provided rich context via "Other" option): 4 paragraphs, ~350-400 words

   Adapt length to match user's investment. Maintain voice at all depths.
```

**Do NOT change:**
- Voice selection instruction (still says "Check the **Voice:** field")
- Echo instruction details
- Card meanings reference instruction
- Shadow aspects instruction
- Specific reflective question examples
- Structure template at end
  </action>
  <verify>
Read skills/tarot/SKILL.md Reading Instructions section and confirm:
- Context depth assessment references wizard responses
- Quick/standard/deep draw adapted for wizard categories
- Voice selection instruction unchanged
- Echo and structure instructions preserved
  </verify>
  <done>Reading Instructions updated to work with wizard-collected context while preserving voice system and structure</done>
</task>

</tasks>

<verification>
After all tasks complete, verify the full wizard flow:

1. **Frontmatter check:**
   ```bash
   head -10 skills/tarot/SKILL.md
   ```
   - No `context: fork` line
   - Still has name, description, agent fields

2. **Wizard section exists:**
   ```bash
   grep -n "Wizard: Collect Reading Parameters" skills/tarot/SKILL.md
   ```
   - Returns a line number (section exists)

3. **AskUserQuestion format present:**
   ```bash
   grep -c "AskUserQuestion" skills/tarot/SKILL.md
   ```
   - Returns >= 2 (mentioned in wizard instructions)

4. **Card meanings preserved:**
   ```bash
   grep -c "### Card" skills/tarot/SKILL.md
   ```
   - Returns 22 (all Major Arcana present)

5. **Voice system preserved:**
   ```bash
   grep -n "Voice System" skills/tarot/SKILL.md
   ```
   - Returns a line number (section exists)

6. **No $ARGUMENTS in Voice parsing:**
   ```bash
   grep "ARGUMENTS" skills/tarot/SKILL.md | grep -i voice
   ```
   - Returns empty (--voice flag parsing removed)
</verification>

<success_criteria>
1. Running `/tarot` triggers wizard flow (AskUserQuestion with 3 tabs)
2. Tab 1 (Question) presents three options + Other for custom input
3. Tab 2 (Spread) presents spread options (placeholder - single card always used)
4. Tab 3 (Mode) presents mode options (placeholder - digital always used)
5. After wizard completes, reading proceeds with collected question/context
6. Voice determined by config files (.tarot > ~/.claude/tarot/config > grounded)
7. All 22 card meanings, voice system, and reading instructions preserved
</success_criteria>

<output>
After completion, create `.planning/phases/06-wizard-infrastructure/06-01-SUMMARY.md`
</output>
