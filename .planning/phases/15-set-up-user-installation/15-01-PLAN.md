---
phase: 15-set-up-user-installation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - bin/install.js
  - .gitignore
autonomous: false

must_haves:
  truths:
    - "npx esoterica downloads package and runs installer"
    - "installer copies skills/tarot/ to ~/.claude/skills/tarot/"
    - "npm install -g esoterica creates global esoterica command"
    - "success message shows installation path and next steps"
  artifacts:
    - path: "package.json"
      provides: "npm package configuration with bin field"
      contains: '"bin":'
    - path: "bin/install.js"
      provides: "CLI installer script"
      contains: "#!/usr/bin/env node"
      min_lines: 50
  key_links:
    - from: "package.json"
      to: "bin/install.js"
      via: "bin field"
      pattern: '"esoterica":\\s*"bin/install.js"'
    - from: "bin/install.js"
      to: "skills/tarot/"
      via: "copyDir function"
      pattern: "skills.*tarot"
---

<objective>
Create npm package configuration and installer script for Esoterica.

Purpose: Enable users to install Esoterica with `npx esoterica` or `npm install -g esoterica` instead of manual git clone.

Output:
- Root package.json with proper npm package metadata
- bin/install.js that copies tarot skill to ~/.claude/skills/tarot/
- Package published to npm registry (human action)
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-set-up-user-installation/15-RESEARCH.md
@skills/tarot/SKILL.md
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create package.json and bin/install.js</name>
  <files>package.json, bin/install.js, .gitignore</files>
  <action>
    **Create package.json** in project root with:
    - name: "esoterica"
    - version: "1.0.0"
    - description: "A tarot reading skill for Claude Code - ancient patterns, new paths"
    - bin field: { "esoterica": "bin/install.js" }
    - files field: ["bin/", "skills/tarot/", "README.md", "LICENSE"] to exclude demo/, brand/, .planning/, docs/
    - keywords: ["claude-code", "skill", "tarot", "ai", "claude"]
    - author and repository fields
    - license: "MIT"
    - engines: { "node": ">=16.7.0" }

    **Create bin/install.js** as Node.js executable:
    - Shebang: #!/usr/bin/env node
    - Use only Node.js built-ins: fs, path, os (no dependencies)
    - Parse --help, --uninstall flags from process.argv
    - Resolve paths:
      - packageRoot = path.join(__dirname, '..')
      - skillSource = path.join(packageRoot, 'skills', 'tarot')
      - skillDest = path.join(os.homedir(), '.claude', 'skills', 'tarot')
    - Implement copyDir function (recursive directory copy)
    - Check if destination exists, warn but overwrite (simpler UX than prompting)
    - Verify installation by checking SKILL.md exists after copy
    - Print success message with path and next steps: "Run /tarot in Claude Code"
    - Use process.exit(0) for success, process.exit(1) for failure

    **Update .gitignore**:
    - Add node_modules/ if not present (for any future dev dependencies)

    Reference research patterns from 15-RESEARCH.md for exact code structure.
  </action>
  <verify>
    - `node bin/install.js --help` shows usage information
    - `ls package.json bin/install.js` shows both files exist
    - `node -c bin/install.js` passes syntax check
    - `cat package.json | grep '"bin"'` shows bin field configured
  </verify>
  <done>
    package.json and bin/install.js exist with correct structure.
    Installer runs locally and shows help text.
  </done>
</task>

<task type="auto">
  <name>Task 2: Test local installation</name>
  <files>(no new files)</files>
  <action>
    **Test the installer locally** before publishing:

    1. Create a temporary backup of existing ~/.claude/skills/tarot/ if it exists
    2. Run `node bin/install.js` from the project root
    3. Verify ~/.claude/skills/tarot/SKILL.md was created
    4. Verify the file content matches skills/tarot/SKILL.md
    5. Run `node bin/install.js --uninstall` to clean up
    6. Restore backup if needed

    **Verify npm pack works:**
    1. Run `npm pack --dry-run` to see what would be published
    2. Confirm only bin/, skills/tarot/, README.md are included
    3. Confirm demo/, brand/, .planning/, docs/ are excluded
    4. Check package size is reasonable (<100KB)
  </action>
  <verify>
    - `npm pack --dry-run 2>&1 | grep -E "(bin/|skills/|README)"` shows included files
    - `npm pack --dry-run 2>&1 | grep -v -E "(demo/|brand/|\.planning/|docs/)"` shows excluded dirs
    - Installation test completed successfully (SKILL.md at destination)
  </verify>
  <done>
    Local installation test passes.
    npm pack shows correct files included/excluded.
    Ready for npm publish.
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Publish package to npm registry</action>
  <why>npm publish requires human authentication (npm login) and cannot be automated</why>
  <instructions>
    1. Ensure you're logged into npm: `npm whoami` (if not, run `npm login`)
    2. Verify the package name "esoterica" is available: `npm view esoterica` (should return 404)
    3. Create LICENSE file if missing: simple MIT license text
    4. Publish: `npm publish`
    5. Verify: `npm view esoterica` shows your package
    6. Test: `npx esoterica` in a fresh directory
    7. Test: `npx esoterica --uninstall` removes the skill
  </instructions>
  <resume-signal>Type "published" when npm publish completes, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
After completion:
1. `npx esoterica` downloads and installs skill to ~/.claude/skills/tarot/
2. `npm install -g esoterica && esoterica` achieves same result
3. Success message shows clear next steps
4. Package visible at npmjs.com/package/esoterica
</verification>

<success_criteria>
- package.json exists with correct bin field and files field
- bin/install.js exists as executable Node.js script
- Local installation test passes
- npm pack shows only intended files
- Package published to npm registry
- npx esoterica works from fresh environment
</success_criteria>

<output>
After completion, create `.planning/phases/15-set-up-user-installation/15-01-SUMMARY.md`
</output>
