---
phase: 19-scroll-video
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - site/public/video/frames/frame-0001.webp
  - site/public/video/frames/frame-0240.webp
autonomous: true

must_haves:
  truths:
    - "Source video is converted to ~240 WebP frames at 24fps"
    - "First frame exists and displays the correct poster image"
    - "Frame files are optimized WebP (~50-80KB each, not raw PNG)"
    - "Total frame sequence is under 20MB"
  artifacts:
    - path: "site/public/video/frames/frame-0001.webp"
      provides: "First frame (poster state)"
    - path: "site/public/video/frames/frame-0240.webp"
      provides: "Last frame (approximate -- actual count depends on video duration)"
  key_links: []
---

<objective>
Extract video frames from the source MP4 into an optimized WebP image sequence for scroll-driven playback.

Purpose: The scroll scrubber component (Plan 02) needs pre-extracted frames to render to canvas. Video element scrubbing is janky -- pre-extracted WebP frames provide frame-perfect, instant rendering at any scroll position.

Output: ~240 WebP frames in `site/public/video/frames/` named `frame-0001.webp` through `frame-NNNN.webp`, each ~50-80KB, totaling under 20MB.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Source video: /Users/jem/Downloads/weavy-Kling First & Last Frame-2026-01-28 at 11.59.12.mp4
- 1928x1072 resolution, h264, 24fps, ~10 seconds, 25MB
- ffmpeg is installed at /opt/homebrew/bin/ffmpeg

Site structure:
@site/astro.config.mjs
@site/public/ (contains: apple-touch-icon.png, favicon files, fonts/, og-image.png)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract and optimize WebP frame sequence</name>
  <files>site/public/video/frames/frame-0001.webp through frame-NNNN.webp</files>
  <action>
Use ffmpeg to extract all frames from the source video and convert to optimized WebP:

1. Create the output directory: `site/public/video/frames/`

2. Run ffmpeg to extract frames:
```bash
ffmpeg -i "/Users/jem/Downloads/weavy-Kling First & Last Frame-2026-01-28 at 11.59.12.mp4" \
  -vf "scale=1920:-2" \
  -quality 75 \
  -compression_level 6 \
  "site/public/video/frames/frame-%04d.webp"
```

Key parameters:
- `scale=1920:-2`: Scale width to 1920px, height auto-calculated (even number for codec compat)
- `-quality 75`: WebP quality -- balances visual fidelity vs file size (~50-80KB per frame)
- `-compression_level 6`: Highest WebP compression effort (slower encode, smaller files)
- `frame-%04d.webp`: Zero-padded 4-digit naming for correct sort order

3. After extraction, verify:
   - Count total frames (should be ~240 for 10s at 24fps)
   - Check average file size (target: 50-80KB each)
   - Check total size (target: under 20MB)
   - Visually confirm frame-0001.webp is a valid image (not corrupt)

4. If total size exceeds 20MB, re-encode with `-quality 65` instead.

5. Create a `site/public/video/meta.json` file containing:
```json
{
  "totalFrames": <actual_count>,
  "fps": 24,
  "width": 1920,
  "height": <actual_height>
}
```
This metadata file lets the scroll scrubber JS know the exact frame count without hardcoding.

IMPORTANT: Do NOT commit the frame files to git. Add `site/public/video/` to `.gitignore`. These are build artifacts that will be generated in CI or stored in LFS/CDN later. For now they live locally.
  </action>
  <verify>
Run these checks:
- `ls site/public/video/frames/ | wc -l` shows ~240 files
- `du -sh site/public/video/frames/` shows total under 20MB
- `file site/public/video/frames/frame-0001.webp` confirms RIFF/WebP format
- `cat site/public/video/meta.json` shows valid JSON with totalFrames matching file count
- `.gitignore` contains `site/public/video/`
  </verify>
  <done>
WebP frame sequence extracted from source video: ~240 frames at 1920px width, ~50-80KB each, under 20MB total. meta.json created with accurate frame count. Video directory gitignored.
  </done>
</task>

</tasks>

<verification>
- Frame count matches expected ~240 (24fps x 10s)
- Frame-0001.webp is a valid WebP image at 1920px width
- Total frame directory size is under 20MB
- meta.json exists with correct totalFrames count
- site/public/video/ is in .gitignore
</verification>

<success_criteria>
Pre-extracted WebP frame sequence ready for the scroll scrubber component. All frames are optimized, correctly named with zero-padded indices, and accompanied by meta.json for runtime consumption.
</success_criteria>

<output>
After completion, create `.planning/phases/19-scroll-video/19-01-SUMMARY.md`
</output>
